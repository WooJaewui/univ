
# 네트워크 계층

---------------------------------------------------------------------------------------------------------------------------------------

> ## IP

### TCP/IP 기본 구조
1. 데이터링크 계층
2. 인터넷 계층
3. 전송 계층
4. 프로세스 응용 계층


### IP 개요
- IP 인터넷 프로토콜 : OSI 모델의 네트워크 계층의 기능
- 사용자에게 복잡한 인터넷의 개별 네트워크들의 구조를 숨겨 모든 호스트들을 연결하는 1개의 가상 네트워크로 보이도록 함
- 네트워크 게층의 투명성(transparency)을 제공함
  - 송신자 호스트는 수신자 호스트까지 경유해야 하는 데이터링크 및 라우터에 관한 물리적 세부 사항을 알지 못해도 데이터그램을 전송할 수 있도록 해줌


### 비연결형 Connectionless 서비스
- 인터넷 계층의 투명성
  - IP 역할 : 호스트의 주소 지정 및 데이터그램 전송
  - 경유해야 한느 데이터 링크 및 라우터 정보를 무시
  - 신뢰성이 없는 데이터 전송


### 데이터그램
- 32bit (word)
- 헤더부분 (4 word)
  - 버전(4비트) : IP version 식별번호
  - 헤더길이(4비트) : 20 ~ 60 bytes
  - 서비스 유형(8비트) : QoS (Quality of Service)
  - 전체 길이(16비트) : 데이터그램 길이
  - 식별자(16비트) : 데이터그램이 단편되었을 때 각 단편은 동일한 식별자를 가짐
  - 플래그(3비트) : DF, MF More Fragment, 1비트는 사용하지 않음
  - 단편 오프셋(13비트) : 메시지가 단편되었을 때 데이터그램 내의 데이터가 원래 메시지의 어느 위치에 있었는지 나타냄
  - TTL Time To Live(8비트) : 데이터그램이 폐기되기 전까지 활동 기간, 라우터를 지날 때마다 1씩 감소, 0이 되면 폐기됨
  - 프로토콜(8비트) : 상위계층 프로토콜 식별, (1 - ICMP, 6 - TCP, 17 - UDP)
  - 헤더 검사합(16비트) : 헤더만의 검사합


### IP 단편화 Fragmentation
- IP 데이터그램의 분할
- MTU Maximum Transfer Unit
  - 네트워크 링크에서 허용하는 프레임당 데이터의 최대 길이
    - Ethernet LAN : MTU = 1,500byte
    - CCITT X.25 : MTU = 128 byte
- IP 데이터그램은 전송 중 각 네트워크의 MTU에 적합한 크기로 분할되었다가 목적지 호스트에서 각 fragment들을 재조립함


### 라우팅
- IP 데이터그램이 목적지 호스트까지 진행하면서 경유할 경로를 결정하는 것
- 비교
  - IP : 송신자, 수신자 그리고 그 사이의 경로 상에 있는 모든 라우터들이 IP 데이터그램 전달에 관여
  - TCP : 송신자와 수신자만 TCP 세그먼트 전달에 관여


### 라우팅 테이블
- 호스트는 자신의 물리적 네트워크에 연결된 라우터에 대한 정보를 자신의 라우팅 테이블에 관리


### 서브넷 마스크
- IP 주소에 대한 네트워크 아이디와 호스트 아이디를 구분하기 위해서 사용된다

---------------------------------------------------------------------------------------------------------------------------------------

> ## 주소변환

### ARP Address Resolution Protocol
- 상대방 호스트의 IP 주소를 알고 데이터 통신을 위해 그 호스트의 물리주소를 알고자 할 때 사용하는 프로토콜
- IP 주소를 물리주소로 매핑해 주는 프로토콜


### 동적 바인딩
- ARP는 호스트의 IP 주소를 대응하는 물리 주소로 변환하여 실제 데이터 통신이 가능하게 해줌
  - IP 주소 : 32비트(4 byte)
  - 물리 주소(MAC) : 48비트(6 byte)
- ARP 요청 : broadcasting
- ARP 응답 : unicasting


### RARP Reverse ARP
- 물리주소만 알고 있는 호스트가 자신의 IP 주소를 찾을 때 사용되는 프르토콜
- 일반적으로는 호스트의 IP 주소는 디스크에 저장된 구성 파일에서 확인
- 디스크가 없는 호스트는 물리주소만 알고 있으므로 이를 이용하여 IP 주소를 얻고자 함

---------------------------------------------------------------------------------------------------------------------------------------

> ## ICMP

### ICMP Internet Control Message Protocol
- 인터넷 계층 프로토콜
- 전송 오류 제어
  - IP는 비연결성 비신뢰성 전송 서비스(실패 가능성 있음)
  - IP 데이터그램 전송의 오류가 발생할 경우 오류 메시지 또는 제어 메시지를 제공해주는 프로토콜
  - IP 데이터그램의 전송과정에서 발생하는 오류를 라우터나 발신지 호스트에게 보고하는 메커니즘을 제공
  - 즉, IP의 전송 실패를 대신 처리해줌
  

### ICMP 메시지 유형
1. 오류 보고 메시지 error reporting
   - ICMP는 오류를 수정하지 않고, 단지 보고만 수행
   - IP 주소를 이용하여 발신지에 오류 전송
2. 질의 메시지 simple query
   - 일부 네트워크의 문제를 진단


### 오류 보고 메시지
1. 발신지 억제
  - 데이터그램이 라우터와 호스트의 처리능력을 초과할 정도로 도착하여 포화상태
2. 시간 초과
  - TTL 필드의 값이 0으로 감소되어 폐기
3. 목적지 도달 불가
  - 라우터가 데이터그램을 최종 목적지에 전달할 수 없음
4. 재지정
  - 다른 라우터를 통해 보다 좋은 경로로 IP 패킷을 전달

---------------------------------------------------------------------------------------------------------------------------------------

> ## IGMP

### IGMP Internet Group Management Protocol
- 인터넷 계층 프로토콜
- 인터넷에서 multicast 서비스를 위해 사용되는 프로토콜
- IP 호스트가 어떤 멀티캐스트 그룹에 참가하고 있는지를 멀티캐스트 라우터에 통보하는 프로토콜


### Multicast
- 하나의 그룹에 속한 호스트들에게 메시지 전송(1-to-many)
- 참고 : unicast(1-to-1), broadcast(1-to-all)


### IGMP 메시지
1. 유형(8비트)
2. 최대 응답시간(8비트) : 질의에 응답해야 하는 최대 허용 식간
3. 검사합(16비트) : 전체 IGMP 메시지의 오류 검사
4. 그룹 주소(32비트) : 멀티캐스트 주소(클래스 D IP 주소)

---------------------------------------------------------------------------------------------------------------------------------------

> ## DHCP

### IP 주소 관리 방법
- IP 주소(32비트)
- 기억하기 어려움 => IP 주소 관리 방법의 필요
  - Host Table
  - DNS(Domain Name System)
  - BOOTP(Bootstrap Protocol)
  - DHCP(Dynamic Host Configuration Protocol)


### 호스트 테이블
- 모든 IP 주소와 이와 mapping 되는 호스트 이름으로 구성된 테이블
- 장점
  - 중앙집중형 관리 방식
  - host table 구조가 간단함
- 단점
  - 호스트의 급속한 증가와 변화에 대응하기 어려움
    - 매핑 정보의 일관성 유지 어려움
  - 계층적 구조가 아닌 평면 구조
    - 중복 정보를 포함함


### DNS Domain Name System
- 계층적 구조 및 분산 관리 특성
- 분산 관리의 문제
  - name server는 특정 네트워크 영역만의 정보를 가지며 다른 영역에 대해서는 다른 name server의 정보를 참조
- name server 데이터의 복잡성
  - 수작업에 의한 데이터의 오류 가능성


### BOOTP Boostrap Protocol
- 기존의 방식은 IP 주소를 수작업으로 할당(정적 할당)
- BOOTP는 동적으로 IP 주소를 할당
- 디스크가 없는 호스트(X 터미널)에 대해 주소 및 설정 정보를 자동적으로 할당하고 관리하는 프로토콜


### DHCP Dynamic Host Configuration Protocol
- 응요계층 프로토콜
- BOOTP에서 발전된 동적 주소 할당 프로토콜로서 IP 주소 재사용이 가능함
- DHCP 메시지 형식은 BOOTP와 동일함
- 동적 주소 할당 프로토콜
  - IP 주소 pool에서 사용 가능한 IP 주소를 선택하여 원하는 호스트에게 일정기간 임대해줌















