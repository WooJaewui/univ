
# 전송 계층

---------------------------------------------------------------------------------------------------------------------------------------

> ## 전송 계층

### 전송 계층
- 시스템 종단에서 투명한 데이터를 양방향으로 전달하는 계층
- 네트워크 계층은 데이터 전송에 대한 신뢰성을 보장하지 않음
- 오류를 점검하여 오류 발생시 재전송을 요청함으로써 신뢰성 제공


### 전송 계층 프로토콜
- 인터넷에서 가장 많이 사용되는 프로토콜
- UDP User Datagram Protocol
- TCP Transmission Control Protocol
- 연결형 통신 vs 비연결형 통신

---------------------------------------------------------------------------------------------------------------------------------------

> ## UDP

### UDP User Datagram Protocol
- 전송 계층 프로토콜
- 비연결성과 비신뢰성
- 기본적인 IP 데이터 전달 서비스에 프로세스 간 통신이 추가된 형태 (process-to-process protocol)
- 연결성 보장과 신뢰적 전송에 소요되는 오버헤드가 없음
- 간단한 메시지를 송수신하는 데 유리


### Socket Address
- IP 주소 + Port 번호
  - IP 주소 : 호스트의 주소를 나타냄
  - port 번호 : 어플리케이션의 주소를 나타냄


### 응용 프로세스의 데이터 전송
- 응용 프로세스는 다음 프로토콜을 이용하여 데이터를 다른 응용 프로세스 전송할 수 있음
  - UDP : 비연결형, 비신뢰성 전송 서비스
  - TCP : 연결형, 신뢰성 전송 서비스
- 포트 번호 사용 (프로세스들을 구별하기 위함)


### UDP의 특징
- 최종 목적지의 데이터 수신 여부를 확인하지 않음 (데이터 손실 가능성)
- 메시지의 도착순서를 재종허지 않음 (데이터의 순서가 틀릴 가능성)
- 호스트 사이에 데이터 흐름 제어 없음 (수신자 처리 용량을 초과하는 데이터 발생 가능성)
- UDP = 비연결형 IP 전달 서비스 + 검사합(checksum 기능


### UDP의 장단점
- 장점
  - TCP보다 데이터 전송속도가 빠르고, 응용 프로그램이 간단해짐
- 단점
  - UDP를 사용하는 응용 프로그램은 메시지 손실, 중복 수신, 수신지연, 잘못된 순서 등을 처리하기 위한 신뢰성 제어 기능을 제공해야 함


### UDP 가짜 헤더 pseudo header
- 검사합을 계산하기 위해 12바이트 가짜헤더를 사용
- UDP 데이터그램이 정확히 목적지에 도착하였는지를 2중으로 인증하기 위함(IP 주소 확인, 오류 검증(검사합))
  - UDP 헤더는 단지 포트번호만 가지고 있고 IP 주소 정보는 없음
- 가짜 헤더의 값은 IP 헤더로부터 얻음
- 데이터그램이 16비트의 배수가 되도록 '0'으로 패딩한 후 전체 UDP 데이터그램의 검사합을 계산
- 가짜 헤더와 패딩은 실제로 전송되지 않아 길이에 포함 안됨
- 수신자는 검사합 필드를 '0'으로 저장하여, 가짜헤더, UDP 헤더 및 사용자 데이터를 모두 포함하여 검사합을 계산


### 포트 번호
- 서버 프로세스는 잘 알려진 포트 번호 사용
- 클라이언트 프로세스는 임시 포트 번호 사용


### UDP Well-known Ports
- 7 echo : UDP 데이터 프로그램을 에코함
- 9 discard : 수신한 UDP 데이터그램을 버림
- 11 systat : 활동중인 사용자 정보 반환
- 13 daytime : 날짜 및 시간 반환
- 15 netstat : 시스템의 인터페이스에 대한 정보 반환
- 53 nameserver : DNS 네임 서버
- 67 bootps : Bootstrap 프로토콜 서버
- 68 bootpc : Bootstrap 프로토콜 클라이언트
- 69 tftp : TFTP 서버

---------------------------------------------------------------------------------------------------------------------------------------

> ## TCP

### TCP Transmission Control Protocol
- 전송 계층 프로토콜
- process-to-process protocol
- 연결지향 connection-oriented 전송 서비스
  - 연결 설정 - 데이터 전송 - 연결 해제
  - TCP 연결 식별자
    - 송신측 RCP 종점 주소
    - 수신측 TCP 종점 주소
  - 신뢰성
    - 흐름 제어 (sliding window protocol)
    - 오류 제어 (응답 패킷, 시간 초과, 재전송 방식)
- 신뢰성이 요구되는 응용
  - UDP : 응용 프로그램에서 신뢰성 보장
  - TCP : 전송 계층(TCP)에서 신뢰성 보장
- 방대한 양의 데이터 전송 (TCP) 사용


### 신뢰성 제공 방법
- 연결지향(connection-oriented) 데이터 전송
- Segment 단위의 전송 (MSS Maximum Segment Size)
- 흐름 제어 flow control, sliding window 사용
- 오류 제어 응답 패킷, 시간 초과, 재전송 방식
  - 타이머 관리
  - Checksum, 순서 보장, 중복 패킷 방지


### TCP 헤더
- 발신지 포트(2bytes) : 발신지 TCP 사용자 프로세스 식별
- 목적지 포트(2bytes) : 목적지 TCP 사용자 프로세스 식별
- 순서 번호(4bytes) : 데이터 필드의 첫 번째 데이터 바이트의 순서 번호
- 응답 번호(4bytes) : 송신측으로부터 받은 세그먼트에 대한 응답, 바로 다음에 받기를 기대하는 순서 번호를 의미함
- 헤더 길이(4bits) : 4바이트 단위로 표시되는 헤더의 길이, 5 ~ 15 사이의 값
- 예약(6bits)
- 제어(6bits)
  - URG : 긴급 포인터 필드가 유요함을 표시함
  - ACK : 응답번호가 유효함을 표시함
  - PSH : 가능한 빨리 현재 세그먼트를 상위 계층에 전달해야 함
  - RST : 연결을 재설정(reset) 함
  - SYN : 연결을 초기화하기 위해 순서번호를 동기화시킴
  - FIN : 연결을 해제시키기 위해 현재 세그먼트가 마지막 데이터임을 표시함
- 윈도우 크기(2bytes) : 흐름제어를 위한 윈도우의 크기를 명시
- 검사합(2bytes) : 오류제어를 위한 검사합 부분
- 긴급 포인터(2bytes) : 긴급 데이터의 마지막 바이트의 순서 번호 (= 긴급포인터 + 순서 번호)
- 옵션(0 ~ 40bytes) : MSS(Maximum Segmenet Size), 윈도우 크기를 증가시키기 위한 값, time stamp 등


### TCP 연결
- TCP는 연결-지향 프로토콜
- 데이터를 전송하기 전에 발신지와 목적지 간에 가상경로를 설정하고 데이터 전송 후 해제
- TCP 모든 세그먼트는 가상경로를 통해 전송
- 이에 따른 손상 또는 손실된 세그먼트의 재전송 및 확인 응답 처리 가능
- TCP 종단(endpoint) 식별자(=socket address)
  - 호스트 IP 주소와 포트 번호로 정의
- 3-way handshaking
  - SYN
    - 클라이언트가 서버에 세그먼트 1을 전송
  - ACK, SYN
    - 서버가 클라이언트 요청에 대한 응답 세그먼트 2 전송
  - ACK
    - 서버의 응답에 대한 클라이언트의 응답 세그먼트 3 전송
  

### 초기 순서번호 ISN Initial Sequence Number
- 난수발생기
- 양 방향이 서로 다른 ISN을 사용함


### TCP 연결 종료
- FIN
  - 클라이언트 응용계층 사용자 close
- ACK, FIN
  - 클라이언트 응용계층 사용자에게 EOF 전달
  - 서버 응용계층 사용자 close
- ACK 
  - 서버 응용계층 사용자에게 EOF 전달





















