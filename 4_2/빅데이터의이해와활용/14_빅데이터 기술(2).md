
# 빅데이터 기술.

--------------------------------------------------------------------------------------------------------------

> ## 대스크 Dask.

### 파이썬 Python.
- 데이터과학의 핵심 언어.
- 다양한 라이브러리를 활용하여 원하는 작업이 가능.
- 파이선 기반 오픈소스 데이터과학 스택 : NumPy, SciPy, Pandas, Matplotlib, Scikit-learn 등.
- Numpy : 파이선용 수치계산 라이브러리.
- Pandas : 데이터프레임 등을 제공하여 파이선으로 데아터를 분석.
- Scikit-learn : 파이선용 기계학습 라이브러리.

### 대스크 Dask.
- 팬더스의 한계.
  - 모든 데이터가 메모리에 들어있어야 함.
  - 대용량 데이터 분석에 한계.
- 대스트.
  - 팬더스의 한계를 분산환경으로 극복.
- 매튜 로클린이 2015년 발표.
- 가상 데이터프로임과 병렬처리용 작업 스케줄러를 통해 스파크와 비슷한 기능을 가지도록 설계.
- 넘파이, 팬더스와 비슷하여 이용자가 쉽게 관련 코드를 배울 수 있음.

### 대스크의 구성.
1. Dask 서브시스템.
   - 스케줄러.
     - 계산 그래프 생성.
     - 업무 분산.
2. 저수준 API.
   - Dask Delayed 객체.
     - 게으른 평가.
   - Dask Futures 객체.
     - 즉시 평가.
3. 고수준 API.
   - Dask Array.
     - 병렬 Numpy.
   - Dask Bag.
     - 병렬 list.
   - Dask Dataframe.
     - 병렬 Pandas.
   - Dask ML.
     - 병렬 scikit-learn.

### 대스크의 이점.
- 완전히 파이선으로 구현되어 넘파이, 팬더스 및 사이킷런을 언어 수준에서 분산 환경으로 확장.
- 단일 (비분산) 환경의 중용량 데이터와 분산 클러스터의 빅데이터 모두를 효과적으로 다룰 수 있음.
- 즉, 대스크에서 사용하는 기본 개체는 파이선 데이터 과학 스택의 각 라이브러리의 해당 개체가 됨.

### 대스크 데이터프레임과 배열.
- 대스크 데이터프레임.
  - 작은 크기의 팬더스 데이터 프레임 다수로 구성.
- 대스크 배열.
  - 작은 넘파이 배열들로 구성.
- 청크(파티션)
  - 작은 크기의 단위.
  - 클러스터 내에서 시스템 간에 전송되거나 로컬에서 한 번에 한 조각씩 처리할 수 있음.
- 빅데이터를 수많은 작은 조각으로 나누고 각 조각에 대해 계산 함수의 병렬 실행을 관리.
- 한 대의 컴퓨터로 처리하기에는 너무 큰 데이터 세트를 마치 소용량 데이터를 다루는 것처럼 처리.

### 대스크의 사용자 경험.
- 팬더스 및 넘파이 사용자에게 이미 친숙한 많은 기능을 구문적으로 동일하게 사용.
- 파이선 오픈소스 데이터 과학 스택인 팬더스, 넘파이 및 사이킷런은 널리 사용되고 사용자가 매우 많음.
- 기존의 소용량 데이터 처리 경험을 중대형 데이터 처리로 쉽게 전환.

### 대스크와 분산환경.
- 단일 컴퓨터에서 중소용량 데이터를 이용하여 데이ㅏ터 분석 코드의 프로토타입을 만들고, 필요할 때 해당 작업을 분산 환경으로 쉽게 확장.
- 분산 환경 특유의 문제.
  - 리소스 관리.
  - 복구 및 데이터 이동.
- 대스크에서는 이를 처리하기 위해 기존 코드를 크게 수정하거나 추가 코드를 작성하지 않고도 작업을 수행 가능.
- 단일 컴퓨터에서 실행 중일 때는 로컬 작업 스케줄러를 사용.
- 분산 환경에서 실행 중일 때는 분산 작업 스케줄러를 사용.
- 사용자는 스케줄러를 상위 계층의 파이선 함수(넘파이,팬더스,사이킷런)만을 이용해 일관적인 방식으로 접근하도록 설계됨.
- 얀 등 클러스터매니저를 이용, 기존 클러스터를 분산 작업 스케줄러와 함께 사용 가능.
- 일반적인 분산 환경에서는 프로그래머가 데이터를 분할하거나 어느 서버에서 어떤 작업을 실행해야 할지에 대해서 생각하고 일일이 프로그램으로 지정해야 함.
- 대스크에서는 빅데이터의 분산 처리를 위한 작업 분할에 대하여 고민할 필요 없이 데이터 자체와 그 데이터를 가지고 무엇을 할 것인가에 대해서만 집중.

--------------------------------------------------------------------------------------------------------------

> ## 계산 그래프.

### 분산 계산의 원리.
    // 함수1
    double(x) = 2x

    // 함수2.
    add(a,b) = a+b

    // 계산.
    x = double(1)
    y = dobule(2)
    z = add(x,y)
- 변수 z의 값을 구하기 위해서는 x, y의 값을 알아야 함.
- x,y의 값이 정해지기 위해서는 double() 함수를 수행해야 함.

### 계산 그래프.
- 동그라미 : 함수의 호출.
- 네모 : 함수의 리턴값.

### 계산 순서 결정.
- 변수 x와 y의 계산 순서는 중요하지 않음.
- 동시에 평가되어도 무방.
- 계산 그래프는 최종 계산 결과를 얻기 위한 계산의 순서를 나타냄.
- 계산 그래프를 보면 최종 결괏값을 어떤 순서로 계산해야 하는지, 그 중 동시에 계산해도 문제가 없는 부분이 있는지를 분석할 수 있음.

### 대스크 스케줄러.
- 계산 그래프를 만들어 계산의 수행 순서를 결정.
- 게으른 평가 lazy evaluation.
  - 대스크 객체의 평가는 일반적인 파이선 개체와는 달리 즉시 이루어지지 않음.
- 계산 중단 단계의 평가를 지연시키면 최종 계산에 대한 계산 그래프를 계산 수행 전에 알 수 있음.
- 중간 단계는 평가가 되지 않았기 때문에 생성된 delayed 개체의 아이디만 표시됨.
- 대스크 스케줄러가 계산 그래프에 따른 분산 계산 스케줄을 결정.
- 분산 시스템.
  - 동시에 평가될 수 있는 중간 계산들을 분산시켜 동시에 계산.
- 단일 시스템.
  - 순차적으로 평가.
- 최종 계산.
  - 대스크 객체의 .compute() 함수를 사용.
  - 주어진 계산 환경에 따라 결정된 계산 스케줄대로 계산.

### 분산 계산의 핵심 원리.
- 데이터 4개 -> 40억 개.
- 분산 계산 클러스터 4대 -> 40대 컴퓨터.
- 분산 파일 시스템(HDFS 등)을 이용해 해당 자료를 40대 컴퓨터의 하드디스크에 1억 개씩 분산 저장.
- 각 컴퓨터에서 자신이 갖고 있는 1억 개의 자료에 대해 inc() 연산을 수행.
- 연산이 40배 빨라지는 효과.
- 분산 환경이 대용량 데이터를 처리할 수 있는 핵심 원리.

--------------------------------------------------------------------------------------------------------------

> ## Dask를 사용한 기계학습.

### MNIST 데이터.
- 0부터 9까지의 숫자를 많은 사람들이 손으로 쓴 것을 스캔하여 19x19 해상도의 흑백 디지털 영상으로 만든 자료.
- 많은 기계학습 알고리즘의 성능 평가에 사용.
- HDF5 형식으로 파이선이 실행되고 있는 디렉토리에 저장되어 있다고 가정.

### MNIST 데이터 분류.
- 파이선 오픈소스 사이킷런 패키지와 대스크를 결합, 원 사이킷런 코드를 크게 변경하지 않고도 클러스터의 모든 코어를 사용하여 모형을 훈련.














