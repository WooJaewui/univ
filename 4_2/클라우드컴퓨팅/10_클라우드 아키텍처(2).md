
# 클라우드 아키텍처2.

----------------------------------------------------------------------------------------

> ## 무중단 서비스 재배치.

### 시스템 중단.
- 포털 서비스, 금융 서비스 등은 사용자가 상시 이용하는 기초 서비스를 제공해야 함.
  - 1년 365일 동작.
  - 사용자 접속 불능 시 서비스 품질 및 신뢰도 저하.
- 시스템이 중단되는 경우.
  - 사용자의 요청이 클라우드 서버가 처리 가능한 용량을 벗어난 경우.
  - 유지보수를 위한 일시적인 다운 타임을 필요한 경우.
  - 신규 물리 서버로 이관하는 경우.

### 무중단 서비스를 위한 대응.
1. 온프레미스 환경.
   - 이중화 서버 구조 구축.
   - 서버 구매, 구성, 유지보수 비용.
2. 클라우드 환경.
   - 동작중인 서버를 복제.
   - 새 가상 서버를 생성하여 복제.
   - 이중화 구조도 지원.

### 무중단 서비스 재배치 구조.
- 다운 타임 요구하는 작업 발생하는 경우.
  - 가상화 인프라 관리자가 새로운 물리 서버들에 있는 하이퍼바이저에게 새로운 VM 생성 요구.
  - VM 생성 완료 시 기존 서버에서 동작하는 VM을 복제하여 새로운 VM으로 OS 및 프로그램을 이관.

### 클라우드상의 무중단 서비스 재배치가 갖는 장점.
- 안정적인 서비스 이관.
- 원본 서버의 정비 작업 완료 시 새 VM을 원본 서버의 VM으로 다시 복제하여 다운 타임 최소화.
- 사용자의 요청이 클라우드 VM 처리 가능한 용량을 벗어난 경우 로드 밸랜서와 네트워크 연결이 자동으로 이루어짐.

### 가상 디스크 이관.
- VM 디스크가 로컬, 비공유 디스크인 경우 데이터 이관 시간이 길게 소요.
- 원격 공유 디스크에 데이터가 저장되어 있을 떄는 가상 서버의 이관 시간이 적게 소요.
- 이관 시간이 적지만, 이관 이후 데이터 접근속도가 로컬 디스크에 비해 느린 다점이 있음.
- 로컬과 고융 디스크의 적절한 데이터 분배가 중요.
  - OS와 서비스 구동에 필요한 프로그램 코어 파일.
  - 자주 접근되는 데이터, 데이터베이스.
  - 그 외의 데이터는 공유 디스크에 저장.

### 가상 디스크 이관의 2가지 방법.
1. 가상 서버 디스크가 로컬 스토리지 타입 혹은 비공유 디스크인 경우.
2. 가상 서버에 디스크가 원격 공유 디스크인 경우.

----------------------------------------------------------------------------------------

> ## 무정지 서비스.

### 클라우드 서비스 장애의 원인.
- 물리 서버의 시스템 장애.
- 장비 노후로 인한 무응답.
- 물리적 고장.
- 물리 서버가 이중화 되어있지 않는 경우 장애가 발생 시 SPOF 발생.

### SPOF Single Point Of Failure.
- 시스템 구성 요소 중 정상적으로 동작하지 않으면 시스템 전체가 중단되는 지점 또는 장치.

### 무정지 서비스를 지원하는 시스템.
1. 장애 방지 시스템 Fault tolerance system.
   - 시스템의 일부의 결함, 고장이 발생하여도 정상적 혹은 부분적으로 기능을 수행할 수 있는 시스템.
2. 장애 조치 시스템 Failover system.
   - 컴퓨터 서버, 시스템, 네트워크 등에서 이상이 생겼을 때 예비 시스템으로 자동 전환되는 기능을 수행하는 시스템.

### 웹 애플리케이션 예시.
- 장애 방지.
  - 서버 한대에 장애가 발생해도 LB가 작업량을 분배하여 시스템 기능을 정상적으로 수행.
- 장애 조치.
  - LB 혹은 네트워크 마비 시 대기중인 서버를 사용하여 사용자의 요청을 처리.

### 클라우드 상의 장애 조치 시스템.
- 장애 이벤트 발생 시 운영중인 가상 서버는 새로운 물리 서버의 하이퍼바이저에게 새 가상 서버 생성 요청.
- 가상 서버 생성 완료 시 운영중인 가상 서버를 마이그레이션.

----------------------------------------------------------------------------------------

> ## 동적 장애 감지 및 복구.

### 물리 리소스에 발생하는 장애.
- 메모리 에러, 디스크 에러, CPU 에러.
- 장비 노후오 인한 시스템 크래시.
- 방대한 물리 장비들이 배치되어 있는 데이터센터에 장애 발생 시 매번 원인을 찾고 문제 해결하는 것은 비효율적임.
    - 장애 시나리오를 만들고 장애 발생 시 조치 방안에 따라 해결하는 것이 중요.

### 하트비트 모니터링(헬스 체크)
- "하트비트" 보내 응답이 없는 경우 장애로 판단.

### 클라우드 모니터.
- 가상 서버, 네트워크 장비 등의 클라우드 리소스의 사용량과 이벤트가 발생하는지를 감시.
- 이벤트 발생 시 장애 조치.

### 자동 복구 관제 시스템이 수행하는 절차.
- 관찰 및 감시.
- 이벤트 발생 시 대응 행위 결정.
- 이벤트 발생 시 대응 행위 수행.
- 보고.
- 에스컬레이션.

### 에스컬레이션.
- 클라우드 모니터가 장애 상황의 심각성에 따라 클라우드 사업자 및 관리자에게 보고하기까지 거치는 절차.

### 에스컬레이션 절차.
- 장애 조치 이후 배치 파일 실행.
- 시스템 로그에 콘솔 메시지 전송.
- 로그 파일 전송.
- 관리자에게 이메일 메시지 전송.
- SNMP 트랩 전송.













