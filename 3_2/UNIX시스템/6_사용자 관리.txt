
 사용자 관리.



 # 사용자 계정.

사용자 관리.
사용자 계정이 있어야 시스템을 사용할 수 있음.
리눅스는 다중 사용자를 지원하는 운영체제. ( 사용자명 또는 로그인 아이디 )
사용자 계정은 유일한 UID를 가짐. ( 커널이 구분하는 User ID )
관라자 입장에서 사용자 계정 별로 접근 권한을 통제할 수 있음.
사용자 계정에 따라 부여된 권한이 다름.
일반 계정은 자신의 홈 디렉토리를 제외하면 제한된 권한을 가짐.
일반 계정 외에 root 계정( UID= 0 ), 시스템 계정도 있음.

su 명령.
사용자를 전환시키는 명령
"su 사용자아이디" 또는 "su -l 사용자아이디" 를 통해 지정된 사용자의 로그인 셸을 시작시킴.
root 사용자가 아니라면 지정된 사용자의 암호를 알아야 실행시킬 수 있음.
"su -l" 과 같이 사용자가 생략되면 root 사용자로 로그인 함.
단순히 "su를 실행하면 로그인 셸이 아니며, 작업 디렉토리도 바뀌지 않음.
su -c "command" : 1개의 셸 명령을 root 계정으로 실행하는 명령. ( command 부분은 " "로 묶는다 )

sudo 명령.
root 또는 다른 사용자가 되어 명령을 실행하기 위한 명령.
특정 사용자나 그룹 별로 세세한 권한을 부여할 수 있음.
본인의 암호만 필요하며, root 계정의 암호를 부여하지 않음.
/etc/sudoers 파일에서 누가/어디서/어떤 명령을 수행할 수 있는지 설정되어 있어야 함.
sudo -u User이름 command : User이름이 command를 실행하도록 시킴.
sudo -l : 자신에게 sudo를 통해 허용된 명령을 확인할 수 있음.

/etc/sudoers 파일.
root 사용자가 visudo를 사용하여 편집함. ( 문법 오류를 검사하고 안전하게 편집할 수 있음 )
user MACHINE=COMMANDS : user가 Machine에 commands 권한을 가짐.



 # 사용자 계정 만들기.

useradd 명령.
사용자 계정을 만드는 관리자 명령.
useradd [options] username.
useradd -c "kim" songkim : songkim이란 계정을 만듦.
useradd -d home_dir : 새로운 계정의 홈 디렉토리를 설정.
useradd -D [options] : 계정을 생성할 때 사용되는 홈 디렉토리, 기본 그룹 등에 관한 기본 설정을 보여줌.
                             ( 옵션을 통해 기본설정을 변경할 수 있음 )
useradd -e expire_date : 계정의 만료일을 설정.
useradd -g group : 계정이 속한 부 그룹을 지정하며 여러 개으이 지정하려면 콤마로 구분.
useradd -s shell : 사용자의 기본 셸을 설정.
useradd user_id : 사용자의 UID를 수동으로 설정.

사용자 계정의 생성 절차.
/etc/login.defs 파일과 /etc/default/useradd 파일을 읽어서 사용자 계정 생성과 관련된 기본값을 확인.
useradd 명령어에서 주어진 옵션을 검사하여 기본값을 대체할 것인지 확인.
/etc/passwd 파일과 /etc/shadow 파일에 새로운 사용자 계정에 해당하는 항목을 생성.
/etc/group 파일에 새로운 그룹에 해당하는 항목을 추가.
/home/디렉토리에서 사용자 계정의 홈 디렉토리( /home/username )를 생성.
/etc/skel/ 디렉토리에 있는 파일을 사용자 계정의 홈 디렉토리에 복사.

/etc/passwd 파일.
사용자 계정에 관한 정보를 가진 텍스트 파일.
라인 별로 사용자 계정의 정보가 저장됨.
계정의 생성이나 수정을 위해 직접 수정하는 것은 좋지 않음.
각 라인은 콜론( : )으로 구분되는 7개의 필드를 가짐.
사용자계정:암호:UID:GID:설명:설명:홈디렉토리:기본셸
예 : abc:x:500:500:name:/home/kdhong:/bin/bash

/etc/skel 디렉토리.
사용자 홈 디렉토리에 복사되는 파일들을 가짐.
.bash_profile, .bashrc, .bash_logout 등.

/etc/shadow 파일.
사용자 계정의 암호 정보와 '패스워드 에이징' 정보를 가짐.
예 : jaewui:$6$w8j <중간생략> : 16922:0:99999:7:3::
사용자 계정 : 암호화된 비밀번호 :  최종비밀번호 변경일:
0은 비밀번호 변경 후 바꿀 수 없는 기간.
99999는 비밀번호 변경 후 바꿀 수 없는 기간.
7은 비밀번호 만료일 전에 경고를 보내는 날짜 수.
3은 비밀번호의 만료 후 로그인이 가능한 날짜 수.
사용자 계정의 만료일로 빈 값은 계정이 만료되지 않는다는 것.
예약 필드.

change 명령.
사용자의 비밀번호 만료에 관한 정보를 변경하는 관리자 명령.
change [options] username.
change -l username : 자신의 패스워드 에이징 정보를 확인함.
change -d date : 비밀번호의 마지막 변경 날짜를 수정.
change -E date : 사용자 계정의 만료일을 지정. ( -1은 사용하지 않음 )

사용자 계정의 기본 설정.
사용자 계정을 생성할 때 필요한 기본값을 정의한 파일이 있음.
useradd 명령이 참조하는 기본값을 설정한 파일.

/etc/login.defs 파일. ( 기본값을 정의한 파일 )
각 라인은 키워드와 값으로 구성됨.
UID_MIN과 UID_MAX는 UID를 자동 할당할 때 유효 범위를 지정.
USERGROUPS_ENAB은 사용자 계정과 같은 이름의 그룹을 자동으로 만들 지를 지정.

/etc/default/useradd 파일. 
useradd 명령이 참조하는 기본값 설정 파일.
GROUP은 사용자 계정의 주 그룹( 자동 생성을 안할 때 )을 지정.
홈 디렉토리의 생성 위치와 셸의 종류를 지정.
INACTIVE가 0이면 비밀번호 만료 후 즉시 계정을 비활성화, -1이면 기능을 사용하지 않는 것.
EXPIRE 값이 없으면 계정의 만료일이 없는 것.



 # 사용자 계정 수정.

usermod 명령.
사용자 계정의 정보를 수정하는 관리자 명령.
많은 옵션이 useradd 명령과 유사함.
형태 : usermod [options] username.
usermod -g root kdhong : 주어진 사용자의 주 그룹을 root 그룹으로 변경함.
id username : 주어진 사용자의 uid와 gid 정보를 출력함.
usermod -d home_dir : 사용자 계정의 홈 디렉토리를 변경.
usermod -m : -d와 함께 사용되어야 하며 기존 홈 디렉토리의 내용을 새 디렉토리로 복사함.

userdel 명령.
사용자 계정을 삭제하는 관리자 명령.
/etc/passwd 파일에서 해당 라인을 삭제함.
형태 : userdel [options] username.
userdel -r ~ : 홈 디렉토리와 파일을 함께 삭제하고 메일 스풀도 삭제함.
userdel -f ~ : 로그인 중이거나 다른 사용자가 사용 중이어도 삭제하며, 같은 이름의 그룹도 삭제.

사용자 계정 삭제 시 고려사항.
홈 디렉토리도 삭제할 것인가.
계정을 삭제하지 말고 잠금 할 것인가.
삭제될 계정이 소유하는 파일이 또 있는가.
삭제 전에 find / -user username -ls로 확인해야 함.
삭제 후엔 find / -uid UID -ls 또는 find / -nouser -ls로 확인.



 # 그룹 계정과 관리.

그룹 계정.
사용자의 계정들을 모아서 하나의 집합을 이루는 개념.
그룹의 구성원은 특정 파일에 대해 그룹에 부여된 권한을 가짐.
일반 사용자는 bin, mail, sys 등의 시스템 정의 그룹에는 포함될 수 없음.
사용자 계정을 만들 때 주 그룹이 지정됨. 
기본적으로 사용자 계정과 같은 이름으로 그룹 계정이 생성.
사용자 계정은 0개 이상의 부 그룹에 속할 수 있음.

groupadd 명령.
그룹 계정을 만드는 관리자 명령.
groupadd [options] group.
-g gid : 수동으로 GID를 지정.
-r : 시스템 그룹 계정을 생성.
-o : -g 옵션과 함께 사용할 때 기존 그룹의 GID를 사용하는 것.

/etc/group 파일.
그룹 계정의 정보를 가진 텍스트 파일. ( 라인마다 그룹 계정의 정보가 저장됨 )
각 라인은 콜론( : )으로 구분되는 4개의 필드를 가짐.
예 - 그룹계정 : 암호 : GID : 구성원_리스트
암호화된 비밀번호는 /etc/gshadow에 저장됨.
사용자 계정을 부 그룹에 추가하는 방법. usermod -G groups -a username.
사용자가 자신의 그룹을 확인하는 방법. id username, groups username.

사용자 계정과 그룹 및 파일의 접근권한.
사용자가 파일이나 디렉토리를 생성하면 그것의 소유 그룹은 사용자의 주 그룹으로 지정됨.
사용자는 0개 이상의 부 그룹에 속할 수 있음.
사용자 스스로 다른 그룹의 구성원이 되게 할 수 없음.
관리자라면 gpasswd -a user group으로 구성원을 추가할 수 있음.
newgrp group을 실행하면 일시적으로 자신의 주 그룹을 변경할 수 있음.
자신이 속해 있는 그룹 중에서 지정해야 함.
그룹 계정의 비밀번호를 알고 있다면 다른 그룹으로도 지정 가능.
단순히 newgrp를 실행하면 원래 주그룹으로 되돌아감.

gpasswd 명령.
그룹의 관리를 위한 명령. ( 그룹의 관리자가 사용함 ) 
형태 : gpasswd [options] group.
gpasswd -a user : 구성원 추가.
gpasswd -A users : 그룹의 관리자를 지정.
gpasswd -d user : 구성원 삭제.
gpasswd -M users : 구성원 설정.
gpasswd -r : 비밀번호 삭제.

groupmod 명령.
기존 그룹의 정보를 수정하기 위한 명령.
형태 : groupmod [options] group.
groupmod -g gid : GID를 변경.
groupmod -n name : 그룹 이름을 변경.

groupdel 명령.
그룹을 삭제하는 관리자 명령.
그룹 계정 관련 파일에서 해당 라인을 삭제함.
사용자 계정의 주 그룹으로 되어 있는 경우 삭제할 수 없음.
형태 : groupdel group.



 # 사용자 관리를 위한 GUI.

사용자 관리 도구.
데스크톱 메뉴에서 시스템 -> 관리 -> 사용자 및 그룹 을 실행.
root 계정의 비밀번호를 입력.
사용자 추가, 그룹 추가 버튼으로 계정을 추가할 수 있음.
선택된 계정에서 등록정보 버튼으로 정보를 수정할 수 있음.



