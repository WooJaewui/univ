
 리눅스 시작과 종료.



 # 운영체제의 부팅.

부팅과정.
전원을 켜고 로그인 프롬프트가 나올 때까지 과정.
ROM BIOS의 펌웨어가 실행됨. ( BIOS 기반 x86 컴퓨터를 가정 )
하드웨어 검사 후, 부트 로더를 적재.
MBR에 있는 부트 로더가 실행됨. ( Master Boot Record ) 
파티션 테이블을 조사하여 부팅 가능한 파티션을 찾음.
리눅스의 붙트로더인 GRUB를 찾아 적재함. 
GRUB는 그래픽 인터페이스와 멀티부팅을 지원.
커널 이미지와 initramfs를 로드.
커널 이미지는 /boot/vmlinuz-<kernel-version>
initamfs는 부팅 과정에서 필요한 임시 파일시스템.
커널이 실행됨.
커널이 실행되면 하드웨어를 점검하고 초기화함.
메모리, 프로세서, 저장장치, 주변장치 등.
디바이스를 찾고 디바이스 드라이버를 로드함.
루트( / ) 파일 시스템을 마운트하고 검사함.
커널은 /sbin/init 프로그램을 실행시키고 제어를 넘김.
init 프로세스는 시스템 운영을 위한 나머지 초기화 과정을 처리.
init은 부팅이 끝난 후에도 계속 수행됨.

부팅과 초기화.
POST -> BIOS -> 부트 로더 -> Boot device -> GRUB -> kernel + initramsfs 
-> Upstart( /sbin/init ) -> /etc/init/rcS.conf 또는 /etc/init/rc.conf.



 # 초기화 데몬.

전통적 init 데몬.
System V init 데몬이라고도 한다.
runlevel에 기초하여 순차적으로 서비스를 실행하는 방식.
runlevel에 따라 실행되어야 또는 중단되어야 하는 서비스가 정해짐.
시간이 오래 걸리며, 복잡한 초기화 스크립트로 인해 새 하드웨어나 서비스의 등장에 효율적인 대처가 어려움.

업스타트 init데몬 과 systemd 데몬.
이벤트 기반으로 서비스를 실행하는 방식.
복잡한 스크립트가 간단한 설정 파일들로 대체됨.
Upstart는 Ubuntu에서 개발되어 2006년에 포함되었고 RHEL 6에서 채택됨.
systemd 데몬은 2011년 Fedora에서 처음 채택되었음.
RHEL 7과 SUSE 및 Ubuntu 16.04에서 systemd가 Upstart를 대체함.

init프로세스.
업스타트는 /sbin/init 데몬으로 구현됨.
모든 사용자 프로세스의 최상위 조상 프로세스 PID가 1이다.
ps -e 또는 ps ax 명령으로 확인.
나머지 부팅 과정 즉, 시스템 초기화 작업을 실행함.
사용자 환경을 준비함. 시스템 운영을 위한 서비스 프로그램( 데몬 프로그램 )의 실행 등.
계속 수행되며 시스템 운영을 관리하고 셧다운을 처리함.
사용자 프로세스의 정리, 로그아웃 후 로그인 서비스의 제공 등.
/etc/init/ 디렉토리에 있는 'job 설정 파일'을 읽음.
job 설정 파일의 확장자는 .conf
init 데몬이 실행하는 job( 실행 파일 or 셸 스크립트 )이 정의되어 있음.
이벤트가 발생할 때 상응하는 job을 시작하거나 중지시킴.
전통적 init데몬에서는 /etc/inittab 파일을 환경 설정 파일로 사용했음.
inittab 파일이 현재는 초기 런레벨을 설정하는 용도로만 사용됨.
inittab 파일에 업스타트 초기화 과정을 설명하는 내용이 있음.

inittl 명령.
job의 상태를 확인하거나 수동으로 시작/중지시키는 명령.
initctl command job.
initctl list는 모든 job의 상태를 보여줌.
initctl start job 또는 initctl stop job을 사용할 수 있음.

환경 설정 파일과 스크립트.
업스타트 init데몬은 기존 방식과 호환되도록 설계됨.
/etc/init/rsS.conf : 부팅 시 한번 실행되며 시스템 초기화와 관련이 있는 내용이 설정되어 있음.
/etc/init/rc.conf : 부팅되거나 런레벨이 바뀔 때 필요한 서비스를 시작, 필요 없는 서비스를 중단할 때 실행.
/etc/inittab : 부팅 시 정해지는 초기 런레벨이 정의된 파일.
/etc/rc.d/rc.local : 결과적으로 런레벨 2,3,5에서 가장 마지막에 실행되는 스크립트.

init 프로세스와 런레벨.
초기 런레벨은 /etc/inittab 파일에서 id:5:initdefault:와 같이 설정되어 있음.
런레벨이 5로 부팅되는 경우, /etc/rc.d/rc5.d/ 디렉토리에 존재하는 스크립트 파일이 실행됨.
k로 시작하는 스크립트는 해당 서비스의 종료를 위한 것이며,
s로 시작하는 스크립트는 해당 서비스의 시작을 위한 것이다.
이러한 파일은 /etc/rc.d/init.d/ 디렉토리에 존재하는 실제 스크립트 파일에 대한 심벌릭 링크임.
런레벨 2, 3, 5에서 가장 마지막에 실행되는 스크립트는 S99local이 가리키는 /etc/rc.d/rc.local
관리자가 원하는 특별한 초기화 작업을 추가할 수 있음.

런레벨.
0 : 시스템이 종료될 때 사용되는 레벨. 기본값으로 설정 하면 안됨.
1 : 단일 사용자 모드로 로그인 과정 없이 root 사용자로 로그인되며 시스템 점검 등의 관리자 모드.
2 : 기본적으로 네트워크 서비스를 제공하지 않는 다중 사용자 모드.
3 : 모든 네트워킹을 지원하는 다중 사용자 모드. 명령 행 인터페이스( 텍스트 모드 )만 지원.
4 : 사용되지 않음.
5 : 그래픽 사용자 환경을 제공하는 다중 사용자 모드. ( 최근 배포판에서 기본으로 설정 )
6 : 시스템을 재부팅할 때 사용되는 레벨. 기본값으로 설정 하면 안됨.

telinit 명령.
런레벨을 바꾸는 관리자 명령.
예 : telinit 3, telinit 0, telinit 6.

runlevel 명령.
이전 런레벨과 현재 런레벨을 확인하는 명령.
예 : runlevel

chkconfig 명령.
부팅 시 런레벨에 따른 시스템 서비스의 활성화 여부를 확인하거나 변경하는 명령.
예 : chkconfig --list httpd : 각 런레벨에서 모든 서비스의 활성화 여부를 알려줌.
예 : chkconfig --level 345 httpd on : 런레벨 3,4,5에서 httpd 서비스를 활성화.

service 명령.
시스템 운영 중에 /etc/rc.d/init.d/ 디렉토리에 존재하는 초기화 스크립트를 수동으로 실행 또는 중지.
예 : service httpd start : httpd를 시작시킴.
예 : /etc/rc.d/init.d/httpd start : httpd를 시작시킴.
start, stop, restart, reload, status 중 하나를 사용.
예 : service --status -all : 모든 초기화 스크립트의 상태를 출력함.

팁.
데스크톱 메뉴에서 시스템>관리>서비스를 실행하면 나오는 서비스 설정 창에서 서비스의 초기 설정과
실행의 시작/중지를 시킬 수 있음.



 # 시스템 종료.

개인 사용자의 로그아웃.
계정의 사용을 마치고 빠져 나오는 것.
데스크톱 환경에서 시스템 -> 로그아웃.
로그인 셸에서 logout 또는 exit 명령.

시스템의 종료.
관리자가 시스템을 안전하게 셧다운하는 것.
접속 중인 사용자에게 시스템의 종료를 알림.
사용자의 로그인을 차단하고 종료함.
테스크톱 환경에서 시스템 -> 끄기.
다시시작, 취소, 끄기 등을 선택.

shutdown 명령.
시간을 정해 시스템을 안전하게 종료하는 명령.
예 : shutdown [options] time [message]

shutdown 명령 옵션.
-r : 재부팅.
-c : 셧다운의 취소.
-k : 실제 셧다운을 하는 것처럼 경고 메시지만 보냄.
예 : shutdown -r + 10

shutdown time인수.
종료 시간으로 23:15은 절대 시간 형식, +10은 10분 후 종료를 의미.
now는 즉시 종료를 의미.
예 : shutdown -h now.

시스템의 종료 절차.
실제 init프로세스를 통해 런레벨을 바꾸어 셧다운이 처리됨.
init 프로세스는 모든 프로세스에게 종료를 알림.
각 프로세스가 스스로 종료하도록 TERM 시그널을 보냄.
종료하지 않은 프로세스에게 강제 종료를 위한 KILL 시그널을 보냄.
시스템 파일을 잠그고 파일 시스템을 언마운트함.
버퍼에 있는 데이터를 파일 시스템에 기록함. ( sync )
시스템 호출을 통해 커널에 재부팅 또는 종료를 요청함.
-h 또는 -r옵션을 사용하지 않으면 단일 사용자 모드로 재부팅됨.
종료를 위해 halt 명령을, 재부팅을 위해 reboot 명령을 사용할 수 있음.



 # 데스크톱.

데스크톱 환경.
GUI를 제공하는 사용자 환경. ( 그래픽 윈도우, 아이콘, 툴바 등을 마우스 키보드로 조작 )
대부분의 데스크톱은 X 윈도우 시스템에 기반을 둠.
시각적으로 다양한 스타일의 데스크톱이 존재함. 

GNOME.
Red Hat 계열 리눅스에서 기본 데스크톱임.
단순함, 편의성, 안정성에 초점을 맞춤.
터미널 창에서 gnome-control-center&를 실행하면 제어판이 나옴.

KDE.
'K 데스크톱'이라고도 하며 MS 윈도우 환경과 유사.
다양한 프로그램을 통합적ㅇ니 모습으로 보여줌.
yum -y groupinstall 'KDE 데스크탑'으로 설치할 수 있음.
로그인할 때 '그놈' 또는 'KDE'를 선택할 수 있음.


